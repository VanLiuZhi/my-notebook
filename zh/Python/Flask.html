<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Flask | 个人网站</title>
    <meta name="description" content="liuzhi notebook">
    <link rel="icon" href="/my-notebook/logo.png">
  <link rel="manifest" href="/my-notebook/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/my-notebook/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/my-notebook/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/my-notebook/assets/css/styles.123d9d81.css" as="style"><link rel="preload" href="/my-notebook/assets/js/app.123d9d81.js" as="script"><link rel="preload" href="/my-notebook/assets/js/57.011272a7.js" as="script"><link rel="prefetch" href="/my-notebook/assets/css/0.styles.4566aca4.css"><link rel="prefetch" href="/my-notebook/assets/css/10.styles.a96f1b40.css"><link rel="prefetch" href="/my-notebook/assets/css/11.styles.db820060.css"><link rel="prefetch" href="/my-notebook/assets/css/12.styles.27baecdd.css"><link rel="prefetch" href="/my-notebook/assets/css/14.styles.d9b80c01.css"><link rel="prefetch" href="/my-notebook/assets/css/2.styles.8096e6ae.css"><link rel="prefetch" href="/my-notebook/assets/css/6.styles.bb56f95a.css"><link rel="prefetch" href="/my-notebook/assets/css/7.styles.bca84adf.css"><link rel="prefetch" href="/my-notebook/assets/css/8.styles.458330a9.css"><link rel="prefetch" href="/my-notebook/assets/css/9.styles.704fd71b.css"><link rel="prefetch" href="/my-notebook/assets/js/0.4566aca4.js"><link rel="prefetch" href="/my-notebook/assets/js/1.cfe9c73c.js"><link rel="prefetch" href="/my-notebook/assets/js/10.a96f1b40.js"><link rel="prefetch" href="/my-notebook/assets/js/11.db820060.js"><link rel="prefetch" href="/my-notebook/assets/js/12.27baecdd.js"><link rel="prefetch" href="/my-notebook/assets/js/13.80efd87b.js"><link rel="prefetch" href="/my-notebook/assets/js/14.d9b80c01.js"><link rel="prefetch" href="/my-notebook/assets/js/15.17435bac.js"><link rel="prefetch" href="/my-notebook/assets/js/16.d50c8117.js"><link rel="prefetch" href="/my-notebook/assets/js/17.88fa7e8f.js"><link rel="prefetch" href="/my-notebook/assets/js/18.14226db2.js"><link rel="prefetch" href="/my-notebook/assets/js/19.13bb0bf3.js"><link rel="prefetch" href="/my-notebook/assets/js/2.8096e6ae.js"><link rel="prefetch" href="/my-notebook/assets/js/20.307ce541.js"><link rel="prefetch" href="/my-notebook/assets/js/21.152b1a36.js"><link rel="prefetch" href="/my-notebook/assets/js/22.68279112.js"><link rel="prefetch" href="/my-notebook/assets/js/23.ff01dfb3.js"><link rel="prefetch" href="/my-notebook/assets/js/24.fa0648e2.js"><link rel="prefetch" href="/my-notebook/assets/js/25.dc87333b.js"><link rel="prefetch" href="/my-notebook/assets/js/26.2d0b611f.js"><link rel="prefetch" href="/my-notebook/assets/js/27.29f741e0.js"><link rel="prefetch" href="/my-notebook/assets/js/28.7bf8a72f.js"><link rel="prefetch" href="/my-notebook/assets/js/29.c751338c.js"><link rel="prefetch" href="/my-notebook/assets/js/30.2da41fb1.js"><link rel="prefetch" href="/my-notebook/assets/js/31.5ea8c33f.js"><link rel="prefetch" href="/my-notebook/assets/js/32.81e78055.js"><link rel="prefetch" href="/my-notebook/assets/js/33.c5400772.js"><link rel="prefetch" href="/my-notebook/assets/js/34.a7a370ea.js"><link rel="prefetch" href="/my-notebook/assets/js/35.a10cddd6.js"><link rel="prefetch" href="/my-notebook/assets/js/36.721b6807.js"><link rel="prefetch" href="/my-notebook/assets/js/37.3dbaacb9.js"><link rel="prefetch" href="/my-notebook/assets/js/38.c9df08b0.js"><link rel="prefetch" href="/my-notebook/assets/js/39.52a7d225.js"><link rel="prefetch" href="/my-notebook/assets/js/4.3fbd59c2.js"><link rel="prefetch" href="/my-notebook/assets/js/40.eb08522d.js"><link rel="prefetch" href="/my-notebook/assets/js/41.db2e632e.js"><link rel="prefetch" href="/my-notebook/assets/js/42.809cddd0.js"><link rel="prefetch" href="/my-notebook/assets/js/43.e2b5b7f6.js"><link rel="prefetch" href="/my-notebook/assets/js/44.083ad19d.js"><link rel="prefetch" href="/my-notebook/assets/js/45.dc032072.js"><link rel="prefetch" href="/my-notebook/assets/js/46.254fa012.js"><link rel="prefetch" href="/my-notebook/assets/js/47.da9f7663.js"><link rel="prefetch" href="/my-notebook/assets/js/48.f3af0a19.js"><link rel="prefetch" href="/my-notebook/assets/js/49.233bc59c.js"><link rel="prefetch" href="/my-notebook/assets/js/5.595392a5.js"><link rel="prefetch" href="/my-notebook/assets/js/50.43a99bc4.js"><link rel="prefetch" href="/my-notebook/assets/js/51.3ec58d29.js"><link rel="prefetch" href="/my-notebook/assets/js/52.63e821b8.js"><link rel="prefetch" href="/my-notebook/assets/js/53.54a47588.js"><link rel="prefetch" href="/my-notebook/assets/js/54.4762aaf9.js"><link rel="prefetch" href="/my-notebook/assets/js/55.c4a44499.js"><link rel="prefetch" href="/my-notebook/assets/js/56.54ce4d8d.js"><link rel="prefetch" href="/my-notebook/assets/js/58.499a8a63.js"><link rel="prefetch" href="/my-notebook/assets/js/59.081a8d2b.js"><link rel="prefetch" href="/my-notebook/assets/js/6.bb56f95a.js"><link rel="prefetch" href="/my-notebook/assets/js/60.70753c61.js"><link rel="prefetch" href="/my-notebook/assets/js/61.9925d9d2.js"><link rel="prefetch" href="/my-notebook/assets/js/62.10bb8a80.js"><link rel="prefetch" href="/my-notebook/assets/js/63.b4b0dc1d.js"><link rel="prefetch" href="/my-notebook/assets/js/64.dc2ae2d2.js"><link rel="prefetch" href="/my-notebook/assets/js/65.280ffa35.js"><link rel="prefetch" href="/my-notebook/assets/js/66.45bab64f.js"><link rel="prefetch" href="/my-notebook/assets/js/67.9c31ffc5.js"><link rel="prefetch" href="/my-notebook/assets/js/68.598b868f.js"><link rel="prefetch" href="/my-notebook/assets/js/69.463adee0.js"><link rel="prefetch" href="/my-notebook/assets/js/7.bca84adf.js"><link rel="prefetch" href="/my-notebook/assets/js/70.5f5d906d.js"><link rel="prefetch" href="/my-notebook/assets/js/71.3cffd9f7.js"><link rel="prefetch" href="/my-notebook/assets/js/72.dbe0f57d.js"><link rel="prefetch" href="/my-notebook/assets/js/73.865e2b8c.js"><link rel="prefetch" href="/my-notebook/assets/js/74.68ee42eb.js"><link rel="prefetch" href="/my-notebook/assets/js/75.26752d45.js"><link rel="prefetch" href="/my-notebook/assets/js/76.92bc5b01.js"><link rel="prefetch" href="/my-notebook/assets/js/77.3b3317b4.js"><link rel="prefetch" href="/my-notebook/assets/js/78.a8c522f1.js"><link rel="prefetch" href="/my-notebook/assets/js/8.458330a9.js"><link rel="prefetch" href="/my-notebook/assets/js/9.704fd71b.js">
    <link rel="stylesheet" href="/my-notebook/assets/css/0.styles.4566aca4.css"><link rel="stylesheet" href="/my-notebook/assets/css/10.styles.a96f1b40.css"><link rel="stylesheet" href="/my-notebook/assets/css/11.styles.db820060.css"><link rel="stylesheet" href="/my-notebook/assets/css/12.styles.27baecdd.css"><link rel="stylesheet" href="/my-notebook/assets/css/14.styles.d9b80c01.css"><link rel="stylesheet" href="/my-notebook/assets/css/2.styles.8096e6ae.css"><link rel="stylesheet" href="/my-notebook/assets/css/6.styles.bb56f95a.css"><link rel="stylesheet" href="/my-notebook/assets/css/7.styles.bca84adf.css"><link rel="stylesheet" href="/my-notebook/assets/css/8.styles.458330a9.css"><link rel="stylesheet" href="/my-notebook/assets/css/9.styles.704fd71b.css"><link rel="stylesheet" href="/my-notebook/assets/css/styles.123d9d81.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-notebook/" class="home-link router-link-active"><!----> <span class="site-name">个人网站</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-notebook/zh/blog/" class="nav-link">文章</a></div><div class="nav-item"><a href="/my-notebook/zh/Python/" class="nav-link router-link-active">笔记</a></div><div class="nav-item"><a href="/my-notebook/zh/Collect/" class="nav-link">收藏</a></div><div class="nav-item"><a href="/my-notebook/zh/AboutMe/" class="nav-link">关于我</a></div> <a href="https://github.com/VanLiuZhi/my-notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/my-notebook/zh/blog/" class="nav-link">文章</a></div><div class="nav-item"><a href="/my-notebook/zh/Python/" class="nav-link router-link-active">笔记</a></div><div class="nav-item"><a href="/my-notebook/zh/Collect/" class="nav-link">收藏</a></div><div class="nav-item"><a href="/my-notebook/zh/AboutMe/" class="nav-link">关于我</a></div> <a href="https://github.com/VanLiuZhi/my-notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Python</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/my-notebook/zh/Python/collections.html" class="sidebar-link">collections模块</a></li><li><a href="/my-notebook/zh/Python-asyncio/" class="sidebar-link">异步与协程</a></li><li><a href="/my-notebook/zh/Python/Django.html" class="sidebar-link">Django 相关</a></li><li><a href="/my-notebook/zh/Python/Flask.html" class="active sidebar-link">Flask</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-notebook/zh/Python/Flask.html#关于扩展" class="sidebar-link">关于扩展</a></li><li class="sidebar-sub-header"><a href="/my-notebook/zh/Python/Flask.html#自定义url转换器" class="sidebar-link">自定义url转换器</a></li><li class="sidebar-sub-header"><a href="/my-notebook/zh/Python/Flask.html#唯一url" class="sidebar-link">唯一url</a></li><li class="sidebar-sub-header"><a href="/my-notebook/zh/Python/Flask.html#扩展响应" class="sidebar-link">扩展响应</a></li><li class="sidebar-sub-header"><a href="/my-notebook/zh/Python/Flask.html#静态文件管理" class="sidebar-link">静态文件管理</a></li><li class="sidebar-sub-header"><a href="/my-notebook/zh/Python/Flask.html#关于视图" class="sidebar-link">关于视图</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-notebook/zh/Python/Flask.html#标准类视图" class="sidebar-link">标准类视图</a></li><li class="sidebar-sub-header"><a href="/my-notebook/zh/Python/Flask.html#基于调度方法的视图" class="sidebar-link">基于调度方法的视图</a></li></ul></li><li class="sidebar-sub-header"><a href="/my-notebook/zh/Python/Flask.html#使用命令行接口" class="sidebar-link">使用命令行接口</a></li><li class="sidebar-sub-header"><a href="/my-notebook/zh/Python/Flask.html#context" class="sidebar-link">Context</a></li><li class="sidebar-sub-header"><a href="/my-notebook/zh/Python/Flask.html#werkzeug" class="sidebar-link">werkzeug</a></li><li class="sidebar-sub-header"><a href="/my-notebook/zh/Python/Flask.html#配置参数讲解" class="sidebar-link">配置参数讲解</a></li><li class="sidebar-sub-header"><a href="/my-notebook/zh/Python/Flask.html#扩展模块" class="sidebar-link">扩展模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-notebook/zh/Python/Flask.html#flask-script" class="sidebar-link">flask_script</a></li><li class="sidebar-sub-header"><a href="/my-notebook/zh/Python/Flask.html#flask-migrate" class="sidebar-link">flask_migrate</a></li></ul></li><li class="sidebar-sub-header"><a href="/my-notebook/zh/Python/Flask.html#flask-logging" class="sidebar-link">flask_logging</a></li></ul></li><li><a href="/my-notebook/zh/Python/" class="sidebar-link">Python 笔记</a></li><li><a href="/my-notebook/zh/Python/virtualenv.html" class="sidebar-link">python 虚拟环境</a></li><li><a href="/my-notebook/zh/Python/pytest.html" class="sidebar-link">pytest</a></li><li><a href="/my-notebook/zh/Python-socket/" class="sidebar-link">Socket</a></li><li><a href="/my-notebook/zh/Python-threading/" class="sidebar-link">线程</a></li><li><a href="/my-notebook/zh/Python-multiprocessing/" class="sidebar-link">进程</a></li><li><a href="/my-notebook/zh/Python/gunicorn.html" class="sidebar-link">gunicorn</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>MongoDB</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>MySql</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Web</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Algorithm</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>ReadBook</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Mac工具</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Python工具</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JavaScript工具</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Other </span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="flask">Flask</h1> <p><img src="/my-notebook/images/Python/Flask.png" alt="image"></p> <h2 id="关于扩展">关于扩展</h2> <p>通过安装对应的扩展包，可以扩展框架的很多功能（这些扩展和框架会有结合，有点想开启框架的功能一样），Flask的扩展都暴露在flask.ext命名空间下，你可以在环境中通过pip安装好相应扩展，然后再在程序中导入相应的包即可使用扩展。</p> <p>在新的版本中，引入flask扩展不能再从flask.ext导入了，直接从安装模块导入，比如 <code>from flask_sqlalchemy import SQLAlchemy</code></p> <h2 id="自定义url转换器">自定义url转换器</h2> <p>在路由中，使用&lt;&gt;来获取动态参数，默认是字符串类型的，如果想要指定参数类型，需要标记成<code>&lt;converter:variable_name&gt;</code> 这样的格式，类似 <code>&lt;int:quantity&gt;</code>，使用any可以指定多种路径，类似<code>&lt;any(a, b:page_name)&gt;</code>。像any，int做为类型可以自定义，比如定义list类型，代码如下：</p> <pre><code class="hljs python"><span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> parse

<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask
<span class="hljs-keyword">from</span> werkzeug.routing <span class="hljs-keyword">import</span> BaseConverter

app = Flask(__name__)


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ListConverter</span><span class="hljs-params">(BaseConverter)</span>:</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, url_map, separator=<span class="hljs-string">'+'</span>)</span>:</span>
        super(ListConverter, self).__init__(url_map)
        self.separator = parse.unquote(separator)  <span class="hljs-comment"># unquote 对url进行解码</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_python</span><span class="hljs-params">(self, value)</span>:</span>
        <span class="hljs-keyword">return</span> value.split(self.separator)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_url</span><span class="hljs-params">(self, values)</span>:</span>
        <span class="hljs-keyword">return</span> self.separator.join(BaseConverter.to_url(self, value)
                                <span class="hljs-keyword">for</span> value <span class="hljs-keyword">in</span> values)


app.url_map.converters[<span class="hljs-string">'list'</span>] = ListConverter


<span class="hljs-meta">@app.route('/list1/&lt;list:page_names&gt;/')</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">list1</span><span class="hljs-params">(page_names)</span>:</span>
    print(page_names)
    <span class="hljs-keyword">return</span> <span class="hljs-string">'Separator: {} {}'</span>.format(<span class="hljs-string">'+'</span>, page_names)


<span class="hljs-meta">@app.route('/list2/&lt;list(separator=u"|"):page_names&gt;/')</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">list2</span><span class="hljs-params">(page_names)</span>:</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">'Separator: {} {}'</span>.format(<span class="hljs-string">'|'</span>, page_names)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run(host=<span class="hljs-string">'0.0.0.0'</span>, port=<span class="hljs-number">9000</span>)</code></pre> <h2 id="唯一url">唯一url</h2> <p>在路由的装饰器中，如果指定了结尾的反斜杠，类似这样的路径 <code>\page\</code>，那么浏览器访问地址以反斜杠结尾，或者没有反斜杠都可以访问(访问一个不以反斜杠结尾的url会被重定向到到反斜杠的url上)，如果路由是<code>\page</code>，那么浏览器访问以反斜杠结尾会报错。</p> <h2 id="扩展响应">扩展响应</h2> <p>这是一个很常见的需求，对返回对象进行包装，比如返回一个ORM的查询实例，这个是不能被json序列化的，通过扩展返回数据，可以对特定对象进行处理。另一种情况，是重写响应类，<code>app.response = JSONResponse</code></p> <h2 id="静态文件管理">静态文件管理</h2> <p>在创建flask实例的时候，通过static_folder修改默认静态文件路径，<code>Flask(__name__, static_folder='/tmp')</code></p> <h2 id="关于视图">关于视图</h2> <p>通常使用函数视图，但是这样就发挥不出类的作用了，比如继承一个基类，定义一些基础的东西，flask也可以使用基于类的视图</p> <h3 id="标准类视图">标准类视图</h3> <p>标准类视图是继承自 <code>flask.views.View</code>，并且在子类中必须实现 <code>dispatch_request</code> 方法，这个方法类似于视图函数，也要返回一个基于Response或者其子类的对象。通过 <code>app.add_url_rule(url_rule, view_func)</code> 来进行注册</p> <pre><code class="hljs python"><span class="hljs-keyword">from</span> flask.views <span class="hljs-keyword">import</span> View
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonalView</span><span class="hljs-params">(View)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dispatch_request</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"hello"</span>

app.add_url_rule(<span class="hljs-string">'/users/'</span>,view_func=PersonalView.as_view(<span class="hljs-string">'personalview'</span>))</code></pre> <h3 id="基于调度方法的视图">基于调度方法的视图</h3> <p>继承自 <code>flask.views.MethodView</code>，可以对不同的HTTP方法执行对应的函数，使用方法的小写名。在类视图中定义一个属性叫做decorators，然后存储装饰器。以后每次调用这个类视图的时候，就会执行这个装饰器</p> <pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, jsonify
<span class="hljs-keyword">from</span> flask.views <span class="hljs-keyword">import</span> MethodView
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> session

app = Flask(__name__)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login_required</span><span class="hljs-params">(func)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">wrapper</span><span class="hljs-params">(*args, **kwargs)</span>:</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> session.get(<span class="hljs-string">"user_id"</span>):
            <span class="hljs-keyword">return</span> <span class="hljs-string">'auth failure'</span>
        <span class="hljs-keyword">return</span> func(*args, **kwargs)

    <span class="hljs-keyword">return</span> wrapper


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserAPI</span><span class="hljs-params">(MethodView)</span>:</span>
    decorators = [login_required]

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> jsonify({
            <span class="hljs-string">'username'</span>: <span class="hljs-string">'fake'</span>,
            <span class="hljs-string">'avatar'</span>: <span class="hljs-string">'http://lorempixel.com/100/100/nature/'</span>
        })

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">'UNSUPPORTED!'</span>


app.add_url_rule(<span class="hljs-string">'/user'</span>, view_func=UserAPI.as_view(<span class="hljs-string">'userview'</span>))

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run(host=<span class="hljs-string">'0.0.0.0'</span>, port=<span class="hljs-number">9000</span>)</code></pre> <h2 id="使用命令行接口">使用命令行接口</h2> <p>和Django一样，flask框架也提供了很多命令，flask命令需要添加都环境变量，这个一般在安装后就有了。然后需要设置flask应用的环境变量，可以使用 <code>export FLASK_APP='app.py path'</code> 。</p> <p>也可以自定义命令，比如 <code>flask run_test</code> 执行一个测试脚本，代码如下：</p> <pre><code class="hljs python"><span class="hljs-meta">@app.cli.command()</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_test</span><span class="hljs-params">()</span>:</span>
    print(<span class="hljs-string">'this is a test script'</span>)</code></pre> <h2 id="context">Context</h2> <p>理解请求上下文和应用上下文。</p> <h2 id="werkzeug">werkzeug</h2> <p>WSGI 协议工具集</p> <h2 id="配置参数讲解">配置参数讲解</h2> <p>创建app需要传递配置参数，以供各个模块使用</p> <p>SECRET_KEY：密码加盐的参数，推荐设置成系统变量</p> <h2 id="扩展模块">扩展模块</h2> <p>扩展模块很多是基于现有的模块做扩展，封装成flask的扩展，比如把实例加入请求上下文中；模块的更多用法可以参考原模块。</p> <p>需要分析用法的模块，列出项目地址。</p> <h3 id="flask-script">flask_script</h3> <p>用来自定义命令的，不过模块没有维护了，官方也推荐不要再使用它了，推荐使用 <code>@app.cli.command</code> 的形式来添加命令。然后配置环境变量，通过flask command的形式来执行命令。</p> <p>可以使用装饰器，和类来添加命令。装饰器：<code>@manager.command</code>；类：继承Command类，实现run方法。</p> <p>由于是弃用的模块，不再赘述。</p> <h3 id="flask-migrate">flask_migrate</h3> <p>Flask-Migrate是用于处理SQLAlchemy 数据库迁移的扩展工具。当Model出现变更的时候，通过migrate去管理数据库变更。依赖alembic模块。</p> <p>用法：</p> <pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask
<span class="hljs-keyword">from</span> flask_sqlalchemy <span class="hljs-keyword">import</span> SQLAlchemy
<span class="hljs-keyword">from</span> flask_migrate <span class="hljs-keyword">import</span> Migrate

app = Flask(__name__)
app.config[<span class="hljs-string">'SQLALCHEMY_DATABASE_URI'</span>] = <span class="hljs-string">'sqlite:///app.db'</span>

db = SQLAlchemy(app)
migrate = Migrate(app, db)</code></pre> <p>命令：</p> <ol><li><p>初始化
flask db init
这个命令会在当前目录下生成一个migrations文件夹。这个文件夹也需要和其他源文件一起，添加到版本控制。</p></li> <li><p>生成最初的迁移
flask db migrate
此命令会在migrations下生成一个version文件夹，下面包含了对应版本的数据库操作py脚本。</p></li> <li><p>数据库升级
flask db upgrade
最后一步。此命令相当于执行了version文件夹下的相应py版本，对数据库进行变更操作。此后，对model有变更，只要重复migrate和upgrade操作即可。</p></li></ol> <p>由于migrate并不一定全部发现你对model的所有改动，因此生成的py脚本需要review, 有错的话则需要edit。</p> <p>例如目前知道的，表名称表更，列名称变更，或给constraints命名等，migreate都不能发现的。更多限制细节见此：Alembic autogenerate documentation。</p> <p>在Alembic 中，数据库迁移用迁移脚本表示。脚本中有两个函数，分别是upgrade() 和downgrade()。upgrade() 函数把迁移中的改动应用到数据库中，downgrade() 函数则将改动删除。Alembic 具有添加和删除改动的能力，因此数据库可重设到修改历史的任意一点。</p> <p>我们可以使用revision 命令手动创建Alembic 迁移，也可使用migrate 命令自动创建。手动创建的迁移只是一个骨架，upgrade() 和downgrade() 函数都是空的，开发者要使用Alembic 提供的Operations 对象指令实现具体操作。自动创建的迁移会根据模型定义和数据库当前状态之间的差异生成upgrade() 和downgrade() 函数的内容。自动创建的迁移不一定总是正确的，有可能会漏掉一些细节。自动生成迁移脚本后一定要进行检查。</p> <p>查看帮助文档：flask db --help</p> <p>运行flask db init后，提示配置日志输出，默认输出到终端，应该配置日志到文件，方便以后排查问题（看看是谁动了数据库）</p> <h2 id="flask-logging">flask_logging</h2> <p><a href="https://github.com/dgilland/flask-logconfig" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/my-notebook/zh/Python/Django.html" class="prev">
          Django 相关
        </a></span> <span class="next"><a href="/my-notebook/zh/Python/" class="router-link-active">
          Python 笔记
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/my-notebook/assets/js/57.011272a7.js" defer></script><script src="/my-notebook/assets/js/app.123d9d81.js" defer></script>
  </body>
</html>
